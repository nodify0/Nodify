{
  "id": "whatsapp",
  "version": "1.0",
  "name": "WhatsApp",
  "description": "Send messages, images, and documents via WhatsApp Business API.",
  "group": "Social Media",
  "category": "action",
  "shape": "circle",
  "color": "#25D366",
  "icon": "MessageCircle",
  "inputs": [
    {
      "id": "main",
      "label": "Input",
      "position": "left",
      "type": "any",
      "slot": 1
    }
  ],
  "outputs": [
    {
      "id": "main",
      "label": "Output",
      "position": "right",
      "type": "json",
      "slot": 1
    }
  ],
  "properties": [
    {
      "name": "credential",
      "displayName": "WhatsApp API Token",
      "type": "credential",
      "credentialType": "whatsapp",
      "required": true,
      "description": "WhatsApp Business API access token"
    },
    {
      "name": "phoneNumberId",
      "displayName": "Phone Number ID",
      "type": "string",
      "default": "",
      "required": true,
      "description": "Your WhatsApp Business phone number ID"
    },
    {
      "name": "operation",
      "displayName": "Operation",
      "type": "options",
      "default": "sendMessage",
      "options": [
        {
          "value": "sendMessage",
          "label": "Send Message"
        },
        {
          "value": "sendImage",
          "label": "Send Image"
        },
        {
          "value": "sendDocument",
          "label": "Send Document"
        },
        {
          "value": "sendTemplate",
          "label": "Send Template"
        }
      ],
      "description": "The operation to perform"
    },
    {
      "name": "recipientPhone",
      "displayName": "Recipient Phone",
      "type": "string",
      "default": "",
      "required": true,
      "description": "Phone number with country code (e.g., 1234567890)"
    },
    {
      "name": "messageText",
      "displayName": "Message Text",
      "type": "text",
      "default": "",
      "required": true,
      "description": "The message text to send",
      "displayOptions": {
        "show": {
          "operation": ["sendMessage"]
        }
      }
    },
    {
      "name": "imageUrl",
      "displayName": "Image URL",
      "type": "string",
      "default": "",
      "required": true,
      "description": "URL of the image to send",
      "displayOptions": {
        "show": {
          "operation": ["sendImage"]
        }
      }
    },
    {
      "name": "imageCaption",
      "displayName": "Image Caption",
      "type": "text",
      "default": "",
      "description": "Caption for the image",
      "displayOptions": {
        "show": {
          "operation": ["sendImage"]
        }
      }
    },
    {
      "name": "documentUrl",
      "displayName": "Document URL",
      "type": "string",
      "default": "",
      "required": true,
      "description": "URL of the document to send",
      "displayOptions": {
        "show": {
          "operation": ["sendDocument"]
        }
      }
    },
    {
      "name": "documentCaption",
      "displayName": "Document Caption",
      "type": "text",
      "default": "",
      "description": "Caption for the document",
      "displayOptions": {
        "show": {
          "operation": ["sendDocument"]
        }
      }
    },
    {
      "name": "templateName",
      "displayName": "Template Name",
      "type": "string",
      "default": "",
      "required": true,
      "description": "Name of the approved template",
      "displayOptions": {
        "show": {
          "operation": ["sendTemplate"]
        }
      }
    },
    {
      "name": "templateLanguage",
      "displayName": "Template Language",
      "type": "string",
      "default": "en_US",
      "description": "Language code for the template",
      "displayOptions": {
        "show": {
          "operation": ["sendTemplate"]
        }
      }
    }
  ],
  "executionCode": "try {\n  helpers.log('Starting WhatsApp node execution');\n  \n  const accessToken = node.properties.credential.value;\n  const phoneNumberId = node.properties.phoneNumberId.value;\n  const operation = node.properties.operation.value;\n  const recipientPhone = node.properties.recipientPhone.value;\n  \n  helpers.log('Operation:', operation);\n  helpers.log('Recipient phone:', recipientPhone);\n  \n  if (!accessToken) {\n    helpers.error('Access token is missing');\n    throw new Error('WhatsApp access token is required');\n  }\n  \n  if (!phoneNumberId) {\n    helpers.error('Phone Number ID is missing');\n    throw new Error('Phone Number ID is required');\n  }\n  \n  if (!recipientPhone) {\n    helpers.error('Recipient phone is missing');\n    throw new Error('Recipient phone number is required');\n  }\n  \n  let messagePayload = {\n    messaging_product: 'whatsapp',\n    to: recipientPhone\n  };\n  \n  if (operation === 'sendMessage') {\n    const messageText = node.properties.messageText.value;\n    messagePayload.type = 'text';\n    messagePayload.text = {\n      body: messageText\n    };\n    helpers.log('Sending text message:', messageText.substring(0, 50) + '...');\n  } else if (operation === 'sendImage') {\n    const imageUrl = node.properties.imageUrl.value;\n    messagePayload.type = 'image';\n    messagePayload.image = {\n      link: imageUrl\n    };\n    if (node.properties.imageCaption.value) {\n      messagePayload.image.caption = node.properties.imageCaption.value;\n    }\n    helpers.log('Sending image:', imageUrl);\n  } else if (operation === 'sendDocument') {\n    const documentUrl = node.properties.documentUrl.value;\n    messagePayload.type = 'document';\n    messagePayload.document = {\n      link: documentUrl\n    };\n    if (node.properties.documentCaption.value) {\n      messagePayload.document.caption = node.properties.documentCaption.value;\n    }\n    helpers.log('Sending document:', documentUrl);\n  } else if (operation === 'sendTemplate') {\n    const templateName = node.properties.templateName.value;\n    const templateLanguage = node.properties.templateLanguage.value;\n    messagePayload.type = 'template';\n    messagePayload.template = {\n      name: templateName,\n      language: {\n        code: templateLanguage\n      }\n    };\n    helpers.log('Sending template:', templateName, 'in', templateLanguage);\n  }\n  \n  helpers.log('Making request to WhatsApp Business API');\n  \n  const response = await fetch(`https://graph.facebook.com/v18.0/${phoneNumberId}/messages`, {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${accessToken}`,\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify(messagePayload)\n  });\n  \n  const result = await response.json();\n  \n  if (!response.ok) {\n    helpers.error('WhatsApp API error:', result.error?.message || result);\n    throw new Error(`WhatsApp API error: ${result.error?.message || 'Unknown error'}`);\n  }\n  \n  helpers.log('Message sent successfully. Message ID:', result.messages?.[0]?.id);\n  \n  return {\n    ...data,\n    whatsapp: result\n  };\n  \n} catch (error) {\n  helpers.error('WhatsApp node execution failed:', error.message);\n  throw error;\n}",
  "meta": {
    "author": "Nodify System",
    "createdAt": "2025-10-23",
    "updatedAt": "2025-10-23"
  }
}
